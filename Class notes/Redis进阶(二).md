## Redis主从技术应用

### Redis复制

生产环境中，Redis通过持久化功能(RDB和AOF技术)保证了即使在服务器重启的情况下也不会损失(或少量损失)数据。但是由于数据是存储在一台服务器上的。若这台服务器出现硬盘故障等问题，也会导致数据丢失；为了避免单点故障，通常的做法是将数据库复制多个副本以部署在不同的服务器上，这样即使有一台服务器出现故障，其他服务器依然可以以最快的速度提供服务。为此，Redis提供了复制功能，可以实现当一台数据库中的数据更新后，自动将更新的数据同步到其他数据库上；

在复制的概念中，数据库分为两类，一类是主数据库(master)，另一类是从数据库(slave)。主数据库可以进行读写操作，当写操作导致数据变化时自动将数据同步给从数据库，而从数据库一般是只读的，并接受主数据库同步过来的数据。一个主数据库可以拥有多个从数据库

#### Redis复制的几个重要特性

- 一个Master可以有多个Slaves
- Slaves能通过和其他slave的链接，除了可以接受同一个master下面的slaves链接以外，还可以接受同一个结构图中的其他slaves的链接；
- redis复制是在master端时非阻塞的，这意味着master在同一个或多个slave端执行同步的时候还可以接受查询；
- 复制在slave端也是非阻塞的，假设在redis.conf中配置redis这个功能，当slave在执行新的同步时，它仍可以用旧的数据信息来提供查询，否则，可以配置当redis slaves和master失去联系时，slave会给客户端发送一个错误
- 为了有多个slaves可以做只读查询，复制可重复多次，具有可扩展性
- 通过复制可以避免master全量写硬盘的消耗：只要配置master的配置文件redis.conf来"避免保存"（注释掉所有"save"命令），然后连接一个用来持久化数据的slave即可；但是这要确保master不会自动重启

#### Redis主从复制的几种结构

##### 一主一从结构

